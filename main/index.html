<!DOCTYPE html>
<html>
<head>
<title> ESP32 </title>

<script>



function getFile(event) {
	const input = event.target
  if ('files' in input && input.files.length > 0) {
	  placeFileContent(
      document.getElementById('content-target'),
      input.files[0])
  }
}

function placeFileContent(target, file) {
	readFileContent(file).then(content => {
  	target.value = content;
	const parser = new DOMParser();
	xml = parser.parseFromString(content, "text/xml");
	console.log(xml.getElementsByTagName("path"));
  }).catch(error => console.log(error))
}

function readFileContent(file) {
	const reader = new FileReader()
  return new Promise((resolve, reject) => {
    reader.onload = event => resolve(event.target.result)
    reader.onerror = error => reject(error)
    reader.readAsText(file)
  })
}

function submit_helper(a_t, a_hz, b_t, b_hz) {
    fetch('spin', {
        method: 'post',
        headers: {
            '_wb_a_ticks': a_t, 
			'_wb_a_hz': a_hz, 
            '_wb_b_ticks': b_t,
			'_wb_b_hz': b_hz,
        }
    });
}

function submit() {
	submit_helper(document.getElementById("a_ticks").value,
	    	document.getElementById("a_hz").value,
		    document.getElementById("b_ticks").value,	
		    document.getElementById("b_hz").value)	
}

function send_ccode() {
	const content = document.getElementById("input-ccode").value;
	fetch('http://esp32-1.dyn.wpi.edu/ccode', {
		method: 'post',
		body: content
	}).then(e => {
		const span = document.getElementById("response-back");
		if(e.status == 400) {
			span.style = "color: red";
		} else if(e.status == 500) {
			span.style = "color: #c87c07;"
		} else {
			span.style = "color: green";
		}
		e.text().then(x => span.innerText = x)
	})
	console.log("sending ccode", content);
	return false;
}


function onload() {
	// document.body.addEventListener("keypress", e => {
	// 	console.log(e);
	// 	return;
	// 	if(e.key == "") {
	// 		submit_helper(10, 200, 0, 200);
	// 	} else if(e.key == "o") {
	// 		submit_helper(-10, 200, 0, 200);
	// 	} else if(e.key == "e") {
	// 		submit_helper(0, 200, 10, 200);
	// 	} else if(e.key == "u"){
	// 		submit_helper(0, 200, -10, 200);
	// 	}
	// }); 
}

</script>

</head>

<body onload="onload()">

<h1> Whiteboard </h1>

<h2>CCode</h2>

<form onsubmit="return send_ccode()">
	<input style="width: 40%; font-size: 20px" type="text" id="input-ccode"/>
	<input type="submit" value="Run"/>
	<span id="response-back"></span>
</form>


<style>
	.monospaced span {
		font-family: monospace;
		padding-right: 20px;
		width: 200px;
		display: inline-block;
	}
	.monospaced span.inline {
		width: auto;
		padding-right: 0px;
	}
	body {
		margin: 20px;
	}
</style>

<div class="monospaced">
	<h4>Machine Code</h4>
	Machine codes work with the length of the strings.
	There are two spools, A and B.
	<br/>

	<span>m0 [a ticks] [b ticks]</span> adjusts the position of A and B relative to the current position
	<br/>
	<span>m1 [a ticks] [b ticks]</span> sets the position of A and B relative to home
	<br/>
	<span>m10 [A/B]</span> Sets the home of the specified spoool, such that it is currently at the absolute position 0
	<br/>
	<span>m11 [hz]</span> Sets the maximum stepper tick rate in hertz



	<h4>C Code</h4>
	<span>c0 [x] [y]</span> Moves the marker to a specific <span class="inline">[x] [y]</span> position as fast as possible
	<br/>
	<span>c1 [x] [y]</span> Moves the market to a specific <span class="inline">[x] [y]</span> position in a straight line
	<br/>
	<span>c2..9</span> TO BE DETERMINED more complex movements
	<br/>
	<span>c10 ([x] [y])</span> Sets the relative home to the current position, or <span class="inline">[x] [y]</span> if specified
	<br/>
	<span>c11 [home/relative]</span>
	Makes commands like <span class="inline"">c0</span>
	act relative to home or the relative marker
	<br/>

</div>




</body>


</html>